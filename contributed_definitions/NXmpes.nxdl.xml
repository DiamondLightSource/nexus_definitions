<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
# 
# Copyright (C) 2014-2022 NeXus International Advisory Committee (NIAC)
# 
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="application" type="group" name="NXmpes" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
         This is the most general application definition for multidimensional
         photoelectron spectroscopy.
    </doc>
    <group type="NXentry">
        <field name="title"/>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 Datetime of the start of the measurement.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME">
            <doc>
                 Datetime of the end of the measurement.
            </doc>
        </field>
        <field name="method">
            <doc>
                 A name of the experimental method according
                 to the `ISO 18115-1:2023`_ specification.
                 
                 .. _ISO 18115-1:2023: https://www.iso.org/standard/74811.html
            </doc>
        </field>
        <field name="definition">
            <attribute name="version"/>
            <enumeration>
                <item value="NXmpes"/>
            </enumeration>
        </field>
        <group type="NXuser" recommended="true">
            <doc>
                 Contact information of at least the user of the instrument or the investigator
                 who performed this experiment. Adding multiple users if relevant is recommended.
            </doc>
            <field name="name">
                <doc>
                     Name of the user.
                </doc>
            </field>
            <field name="affiliation" recommended="true">
                <doc>
                     Name of the affiliation of the user at the point in time when the experiment was
                     performed.
                </doc>
            </field>
            <field name="address" recommended="true">
                <doc>
                     Full address (street, street number, ZIP, city, country) of the user's
                     affiliation.
                </doc>
            </field>
            <field name="email">
                <doc>
                     Email address of the user.
                </doc>
            </field>
            <field name="orcid" recommended="true">
                <doc>
                     Author ID defined by https://orcid.org/.
                </doc>
            </field>
        </group>
        <group type="NXinstrument">
            <field name="energy_resolution" type="NX_FLOAT" units="NX_ENERGY" recommended="true"/>
            <group name="source_beam" type="NXsource">
                <!--Comment from mpes may workshop:
- Add linking between source and beam
- There is much more information which can be provided for NXsource-->
                <doc>
                     The source used to generate the primary photons. Properties refer strictly to
                     parameters of the source, not of the output beam. For example, the energy of the
                     source is not the optical power of the beam, but the energy of the electron beam
                     in a synchrotron and so on.
                </doc>
                <field name="type">
                    <enumeration>
                        <item value="Synchrotron X-ray Source"/>
                        <item value="Rotating Anode X-ray"/>
                        <item value="Fixed Tube X-ray"/>
                        <item value="UV Laser"/>
                        <item value="Free-Electron Laser"/>
                        <item value="Optical Laser"/>
                        <item value="UV Plasma Source"/>
                        <item value="Metal Jet X-ray"/>
                        <item value="HHG laser"/>
                        <item value="UV lamp"/>
                        <item value="Monochromatized electron source"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="type_other" optional="true">
                    <doc>
                         Specification of type, may also go to name.
                    </doc>
                </field>
                <field name="name" recommended="true"/>
                <field name="probe">
                    <doc>
                         Type of probe. In photoemission it's always photons, so the full NIAC list is
                         restricted.
                    </doc>
                    <enumeration>
                        <item value="photons"/>
                    </enumeration>
                </field>
            </group>
            <group name="beam_probe" type="NXbeam">
                <!--Comment from mpes may workshop: Add linking between source and beam-->
                <!--Add extent as recommended?-->
                <field name="distance" type="NX_NUMBER" units="NX_LENGTH" recommended="true">
                    <doc>
                         Distance of the point of evaluation of the beam from the sample surface.
                    </doc>
                </field>
                <field name="incident_energy" type="NX_FLOAT" units="NX_ENERGY"/>
                <field name="incident_energy_spread" type="NX_NUMBER" recommended="true" units="NX_ENERGY"/>
                <field name="incident_polarization" type="NX_NUMBER" recommended="true" units="NX_ANY"/>
            </group>
            <group type="NXelectronanalyser">
                <group name="model" type="NXfabrication" recommended="true">
                    <field name="vendor" recommended="true"/>
                    <field name="model" recommended="true"/>
                    <field name="identifier" recommended="true"/>
                </group>
                <field name="description"/>
                <field name="energy_resolution" type="NX_FLOAT" recommended="true" units="NX_ENERGY">
                    <doc>
                         Energy resolution of the analyser with the current setting. May be linked from a
                         NXcalibration.
                    </doc>
                </field>
                <field name="fast_axes" type="NX_CHAR" recommended="true"/>
                <field name="slow_axes" recommended="true"/>
                <group type="NXcollectioncolumn">
                    <!--TODO: Comment from Anders Frisk on proposal page
What is the definition of a collection column?
Optional constant settings (like lens focusing parameters on the sample: position_x, position_y, working_distance)-->
                    <field name="scheme">
                        <doc>
                             Scheme of the electron collection column.
                        </doc>
                        <enumeration>
                            <item value="Standard"/>
                            <item value="Angular dispersive"/>
                            <item value="Spatial dispersive"/>
                            <item value="Selective area"/>
                            <item value="Deflector"/>
                            <item value="PEEM"/>
                            <item value="Momentum Microscope"/>
                        </enumeration>
                    </field>
                    <field name="mode" recommended="true"/>
                    <!--TODO: What does this refer to. It is currently not in the collection column base class-->
                    <field name="projection" recommended="true"/>
                    <group name="field_aperture" type="NXaperture" optional="true">
                        <doc>
                             The size and position of the field aperture inserted in the column. To add
                             additional or other apertures use the APERTURE group of NXcollectioncolumn.
                        </doc>
                    </group>
                    <group name="contrast_aperture" type="NXaperture" optional="true">
                        <doc>
                             The size and position of the contrast aperture inserted in the column. To add
                             additional or other apertures use the APERTURE group of NXcollectioncolumn.
                        </doc>
                    </group>
                </group>
                <group type="NXenergydispersion">
                    <field name="scheme">
                        <enumeration>
                            <item value="tof"/>
                            <item value="hemispherical"/>
                            <item value="double hemispherical"/>
                            <item value="cylindrical mirror"/>
                            <item value="display mirror"/>
                            <item value="retarding grid"/>
                        </enumeration>
                    </field>
                    <field name="pass_energy" type="NX_FLOAT" units="NX_ENERGY"/>
                    <field name="energy_scan_mode"/>
                    <group name="entrance_slit" type="NXaperture" optional="true">
                        <doc>
                             Size, position and shape of the entrance slit in dispersive analyzers. To add
                             additional or other slits use the APERTURE group of NXenergydispersion.
                        </doc>
                    </group>
                    <group name="exit_slit" type="NXaperture" optional="true">
                        <doc>
                             Size, position and shape of the exit slit in dispersive analyzers. To add
                             additional or other slits use the APERTURE group of NXenergydispersion.
                        </doc>
                    </group>
                </group>
                <group type="NXdetector">
                    <field name="amplifier_type" recommended="true">
                        <doc>
                             Type of electron amplifier in the first amplification step.
                        </doc>
                        <enumeration>
                            <item value="MCP"/>
                            <item value="channeltron"/>
                        </enumeration>
                    </field>
                    <field name="detector_type" recommended="true">
                        <doc>
                             Description of the detector type.
                        </doc>
                        <enumeration>
                            <item value="DLD"/>
                            <item value="Phosphor+CCD"/>
                            <item value="Phosphor+CMOS"/>
                            <item value="ECMOS"/>
                            <item value="Anode"/>
                            <item value="Multi-anode"/>
                        </enumeration>
                    </field>
                    <group type="NXdata" recommended="true">
                        <!--TODO: Anders Frisk on proposal page
It could be a lot of raw data from a detector. Shpould be optional.-->
                        <attribute name="signal">
                            <enumeration>
                                <item value="raw"/>
                            </enumeration>
                        </attribute>
                        <field name="raw" type="NX_NUMBER">
                            <doc>
                                 Raw data before calibration.
                            </doc>
                        </field>
                    </group>
                </group>
            </group>
            <group type="NXmanipulator" optional="true">
                <doc>
                     Manipulator for positioning of the sample.
                </doc>
                <!--These fields should be NXenvironments and should be changed once NXmanipulator is refactored.-->
                <group name="sample_temperature" type="NXenvironment" recommended="true" units="NX_TEMPERATURE"/>
                <field name="drain_current" type="NX_FLOAT" recommended="true" units="NX_CURRENT"/>
                <field name="sample_bias" type="NX_FLOAT" recommended="true" units="NX_CURRENT"/>
            </group>
        </group>
        <group type="NXprocess" recommended="true">
            <doc>
                 Document an event of data processing, reconstruction, or analysis for this data.
                 Describe the appropriate axis calibrations for your experiment using one or more
                 of the following NXcalibrations
            </doc>
            <group name="energy_calibration" type="NXcalibration" optional="true">
                <field name="applied" type="NX_BOOLEAN">
                    <doc>
                         Has an energy calibration been applied?
                    </doc>
                </field>
                <field name="calibrated_axis" type="NX_FLOAT" recommended="true">
                    <doc>
                         This is the calibrated energy axis to be used for data plotting.
                    </doc>
                </field>
            </group>
            <group name="angular_calibration" type="NXcalibration" optional="true">
                <field name="applied" type="NX_BOOLEAN">
                    <doc>
                         Has an angular calibration been applied?
                    </doc>
                </field>
                <field name="calibrated_axis" type="NX_FLOAT" recommended="true">
                    <doc>
                         This is the calibrated angular axis to be used for data plotting.
                    </doc>
                </field>
            </group>
            <group name="spatial_calibration" type="NXcalibration" optional="true">
                <field name="applied" type="NX_BOOLEAN">
                    <doc>
                         Has an spatial calibration been applied?
                    </doc>
                </field>
                <field name="calibrated_axis" type="NX_FLOAT" recommended="true">
                    <doc>
                         This is the calibrated spatial axis to be used for data plotting.
                    </doc>
                </field>
            </group>
            <group name="momentum_calibration" type="NXcalibration" optional="true">
                <field name="applied" type="NX_BOOLEAN">
                    <doc>
                         Has an momentum calibration been applied?
                    </doc>
                </field>
                <field name="calibrated_axis" type="NX_FLOAT" recommended="true">
                    <doc>
                         This is the momentum axis to be used for data plotting.
                    </doc>
                </field>
            </group>
        </group>
        <group type="NXsample">
            <field name="name"/>
            <group type="NXsubstance">
                <doc>
                     For samples containing a single pure substances. For mixtures use the
                     NXsample_component_set and NXsample_component group in NXsample instead.
                </doc>
                <field name="molecular_formula_hill" recommended="true">
                    <doc>
                         The chemical formula of the sample.
                    </doc>
                </field>
            </group>
            <field name="atom_types" recommended="true">
                <doc>
                     List of comma-separated elements from the periodic table
                     that are contained in the sample.
                     If the sample substance has multiple components, all
                     elements from each component must be included in `atom_types`.
                </doc>
            </field>
            <field name="situation">
                <enumeration>
                    <item value="vacuum"/>
                    <item value="inert atmosphere"/>
                    <item value="oxidising atmosphere"/>
                    <item value="reducing atmosphere"/>
                </enumeration>
            </field>
            <group type="NXsample_history" recommended="true">
                <doc>
                     A set of activities that occurred to the sample prior to/during photoemission experiment.
                     
                     Ideally, a full report of the previous operations (or links to a chain of operations).
                     Alternatively, notes allow for additional descriptors in any format
                     (NXnote allows to add pictures, audio, movies). Alternatively, a
                     reference to the location or a unique identifier or other metadata file. In the
                     case these are not available, free-text description.
                </doc>
                <group name="sample_preparation" type="NXphysical_process" recommended="true">
                    <doc>
                         Details about the sample preparation for the MPES experiment (i.e. cleaving, last
                         annealing).
                    </doc>
                    <field name="start_time" type="NX_DATE_TIME"/>
                    <field name="end_time" type="NX_DATE_TIME" recommended="true"/>
                    <field name="method" optional="true">
                        <doc>
                             Details about the method of sample preparation before the MPES experiment.
                        </doc>
                    </field>
                    <field name="notes" optional="true"/>
                </group>
            </group>
            <group name="temperature" type="NXenvironment" recommended="true">
                <doc>
                     Measured sample temperature.
                     
                     This field may also be found in NXmanipulator if present.
                     In that case, this should be a link to /entry/instrument/manipulator/sample_temperature.
                </doc>
                <group name="thermocouple" type="NXsensor">
                    <field name="name"/>
                    <field name="type" recommended="true"/>
                    <field name="value" type="NX_FLOAT" recommended="true" units="NX_TEMPERATURE">
                        <doc>
                             In the case of a fixed temperature measurement, this is the scalar temperature of
                             the sample.
                        </doc>
                    </field>
                    <group name="value_log" type="NXlog" optional="true" units="NX_TEMPERATURE">
                        <doc>
                             In the case of an experiment in which the temperature is changed and recorded, 
                             this is an array of length m of temperatures.
                        </doc>
                    </group>
                </group>
            </group>
            <group name="gas_pressure" type="NXenvironment" recommended="true">
                <doc>
                     Gas pressure surrounding the sample.
                     
                     This field may also be found in NXinstrument if present.
                     In that case, this should be a link to /entry/instrument/gas_pressure.
                </doc>
                <group name="pressure_gauge" type="NXsensor">
                    <field name="name"/>
                    <field name="type" recommended="true"/>
                    <field name="value" type="NX_FLOAT" recommended="true" units="NX_PRESSURE">
                        <doc>
                             In the case of a fixed gas pressure measurement, this is the scalar gas pressure around
                             the sample.
                        </doc>
                    </field>
                    <group name="value_log" type="NXlog" optional="true" units="NX_PRESSURE">
                        <doc>
                             In the case of an experiment in which the gas pressure is changed and recorded, 
                             this is an array of length m of gas pressures.
                        </doc>
                    </group>
                </group>
            </group>
            <group name="bias" type="NXenvironment" recommended="true">
                <doc>
                     Voltage applied to sample and sample holder.
                     
                     This field may also be found in NXmanipulator if present.
                     In that case, this should be a link to /entry/instrument/manipulator/sample_bias.
                </doc>
                <group name="voltmeter" type="NXsensor">
                    <field name="name"/>
                    <field name="type" recommended="true"/>
                    <field name="value" type="NX_FLOAT" recommended="true" units="NX_VOLTAGE">
                        <doc>
                             In the case of a fixed applied bias, this is the scalar voltage applied to
                             sample and sample holder.
                        </doc>
                    </field>
                    <group name="value_log" type="NXlog" optional="true" units="NX_VOLTAGE">
                        <doc>
                             In the case of an experiment in which the bias is changed and recorded, 
                             this is an array of length m of voltages.
                        </doc>
                    </group>
                </group>
            </group>
            <group name="drain_current" type="NXenvironment" optional="true">
                <doc>
                     Drain current of the sample and sample holder.
                     This field may also be found in NXmanipulator if present.
                     In that case, this should be a link to /entry/instrument/manipulator/drain_current.
                </doc>
                <group name="amperemeter" type="NXsensor">
                    <field name="name"/>
                    <field name="type" recommended="true"/>
                    <field name="value" type="NX_FLOAT" recommended="true" units="NX_CURRENT">
                        <doc>
                             In the case of a fixed current, this is the scalar drain current of the sample
                             and sample holder.
                        </doc>
                    </field>
                    <group name="value_log" type="NXlog" optional="true" units="NX_CURRENT">
                        <doc>
                             In the case of an experiment in which the current changes and is recorded, 
                             this is an array of length m of drain currents.
                        </doc>
                    </group>
                </group>
            </group>
        </group>
        <group type="NXdata">
            <attribute name="signal">
                <enumeration>
                    <item value="data"/>
                </enumeration>
            </attribute>
            <field name="data" type="NX_NUMBER" units="NX_ANY">
                <doc>
                     Represents a measure of one- or more-dimensional photoemission counts, where the
                     varied axis may be for example energy, momentum, spatial coordinate, pump-probe
                     delay, spin index, temperature, etc. The axes traces should be linked to the
                     actual encoder position in NXinstrument or calibrated axes in NXprocess.
                </doc>
            </field>
        </group>
    </group>
</definition>
