<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<definition category="application" extends="NXobject" name="NXapm_paraprobe_results_clusterer" type="group" xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <symbols>
        <doc>
             The symbols used in the schema to specify e.g. dimensions of arrays.
        </doc>
        <symbol name="n_ions">
            <doc>
                 The total number of ions in the reconstruction.
            </doc>
        </symbol>
        <symbol name="n_dict">
            <doc>
                 The total number of entries in the restricted_identifier dictionary.
            </doc>
        </symbol>
    </symbols>
    <doc>
         Results of a paraprobe-clusterer tool run.
    </doc>
    <group maxOccurs="1" minOccurs="1" type="NXentry">
        <attribute name="version">
            <doc>
                 Version specifier of this application definition.
            </doc>
        </attribute>
        <field name="definition" type="NX_CHAR">
            <doc>
                 Official NeXus NXDL schema with which this file was written.
            </doc>
            <enumeration>
                <item value="NXapm_paraprobe_results_clusterer"/>
            </enumeration>
        </field>
        <field name="program" type="NX_CHAR">
            <doc>
                 Given name of the program/software/tool with which this NeXus
                 (configuration) file was generated.
            </doc>
            <attribute name="version" type="NX_CHAR">
                <doc>
                     Ideally program version plus build number, or commit hash or description
                     of ever persistent resources where the source code of the program and
                     build instructions can be found so that the program can be configured
                     ideally in such a manner that the result of this computational process
                     is recreatable in the same deterministic manner.
                </doc>
            </attribute>
        </field>
        <field name="analysis_identifier" type="NX_CHAR">
            <doc>
                 Ideally, a (globally persistent) unique identifier for referring
                 to this analysis.
            </doc>
        </field>
        <field name="analysis_description" optional="true" type="NX_CHAR">
            <doc>
                 Possibility for leaving a free-text description about this analysis.
            </doc>
        </field>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 ISO 8601 formatted time code with local time zone offset to UTC
                 information included when the analysis behind this results file
                 was started, i.e. the paraprobe-tool executable started as a process.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME">
            <doc>
                 ISO 8601 formatted time code with local time zone offset to UTC
                 information included when the analysis behind this results file
                 were completed and the paraprobe-tool executable exited as a process.
            </doc>
        </field>
        <field name="config_filename" type="NX_CHAR">
            <doc>
                 The absolute path and name of the config file for this analysis.
            </doc>
            <attribute name="version" type="NX_CHAR">
                <doc>
                     At least SHA256 strong hash of the specific config_file for
                     tracking provenance.
                </doc>
            </attribute>
        </field>
        <field name="results_path" optional="true" type="NX_CHAR">
            <doc>
                 Path to the directory where the tool should store NeXus/HDF5 results
                 of this analysis. If not specified results will be stored in the
                 current working directory.
            </doc>
        </field>
        <field name="status" type="NX_CHAR">
            <doc>
                 A statement whether the paraprobe-tool executable managed to
                 process the analysis or failed prematurely.
                 
                 This status is written to the results file after the end_time
                 at which point the executable must no longer compute analyses.
                 Only when this status message is present and shows `success`, the
                 user should consider the results. In all other cases, it might be
                 that the executable has terminated prematurely or another error
                 occurred.
            </doc>
            <enumeration>
                <item value="success"/>
                <item value="failure"/>
            </enumeration>
        </field>
        <group optional="true" type="NXuser">
            <doc>
                 If used, contact information and eventually details
                 of at least the person who performed this analysis.
            </doc>
            <field name="name" type="NX_CHAR"/>
            <field name="affiliation" recommended="true" type="NX_CHAR"/>
            <field name="address" optional="true" type="NX_CHAR"/>
            <field name="email" recommended="true" type="NX_CHAR"/>
            <field name="orcid" recommended="true" type="NX_CHAR"/>
            <field name="orcid_platform" recommended="true" type="NX_CHAR"/>
            <field name="telephone_number" optional="true" type="NX_CHAR"/>
            <field name="role" recommended="true" type="NX_CHAR"/>
            <field name="social_media_name" optional="true" type="NX_CHAR"/>
            <field name="social_media_platform" optional="true" type="NX_CHAR"/>
        </group>
        <group type="NXcoordinate_system_set">
            <doc>
                 Details about the coordinate system conventions used.
                 If nothing else is specified we assume that there
                 has to be at least one set of NXtransformations named
                 paraprobe defined, which specifies the coordinate system.
                 In which all positions are defined.
            </doc>
            <group maxOccurs="unbounded" minOccurs="1" type="NXtransformations">
                <doc>
                     The individual coordinate systems which should be used.
                     Field names should be prefixed with the following controlled terms
                     indicating which individual coordinate system is described:
                     
                     * paraprobe
                     * lab
                     * specimen
                     * laser
                     * leap
                     * detector
                     * recon
                </doc>
            </group>
        </group>
        <group maxOccurs="1" minOccurs="0" type="NXprocess">
            <group name="window" type="NXcs_filter_boolean_mask">
                <doc>
                     A bitmask which identifies which of the ions in the dataset were
                     analyzed during this process.
                </doc>
                <field name="number_of_ions" type="NX_UINT" units="NX_UNITLESS">
                    <doc>
                         Number of ions covered by the mask.
                         The mask value for most may be 0.
                    </doc>
                </field>
                <field name="bitdepth" type="NX_UINT" units="NX_UNITLESS">
                    <doc>
                         Number of bits assumed matching on a default datatype.
                         (e.g. 8 bits for a C-style uint8).
                    </doc>
                </field>
                <field name="mask" type="NX_UINT" units="NX_UNITLESS">
                    <doc>
                         The unsigned integer array representing the content of the mask.
                         If padding is used, padded bits are set to 0. The mask is for
                         convenience always as large as the entire dataset as it will
                         be stored compressed anyway. The convenience feature with this
                         is that then the mask can be decoded with numpy and mirrored
                         against the evaporation_id array and one immediately can filter
                         out all points that were used by the paraprobe-toolbox executable.
                         The length of the array adds to the next unsigned integer
                         if the number of ions in the dataset is not an integer
                         multiple of the bitdepth (padding).
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="n_ions"/>
                    </dimensions>
                </field>
            </group>
            <group name="cluster_analysis" optional="true" type="NXprocess">
                <doc>
                     The result of a cluster analyses. These include typically the label for
                     each ion/point documenting to which feature (if any) an ion is assigned.
                     Typically, each analysis/run yields only a single cluster.
                     In cases of fuzzy clustering it can be possible that an ion is assigned
                     to multiple cluster (eventually with different) weight/probability.
                </doc>
                <group maxOccurs="unbounded" minOccurs="0" name="dbscanID" type="NXsimilarity_grouping">
                    <doc>
                         Results of a DBScan clustering analysis.
                    </doc>
                    <field name="eps" type="NX_FLOAT" units="NX_LENGTH">
                        <doc>
                             The epsilon (eps) parameter.
                        </doc>
                    </field>
                    <field name="min_pts" type="NX_UINT" units="NX_UNITLESS">
                        <doc>
                             The minimum points (min_pts) parameter.
                        </doc>
                    </field>
                    <field name="cardinality" type="NX_UINT" units="NX_UNITLESS">
                        <doc>
                             Number of members in the set which is partitioned into features.
                             Specifically, this is the total number of targets filtered from the
                             dataset. Cardinality here is not the total number of ions in the
                             dataset.
                        </doc>
                    </field>
                    <field name="identifier_offset" type="NX_NUMBER" units="NX_UNITLESS">
                        <doc>
                             Which identifier is the first to be used to label a cluster.
                             
                             The value should be chosen in such a way that special values can be resolved:
                             * identifier_offset-1 indicates an object belongs to no cluster.
                             * identifier_offset-2 indicates an object belongs to the noise category.
                             Setting for instance identifier_offset to 1 recovers the commonly used
                             case that objects of the noise category get values to -1 and unassigned points to 0.
                             Numerical identifier have to be strictly increasing.
                        </doc>
                    </field>
                    <field name="targets" type="NX_UINT" units="NX_UNITLESS">
                        <doc>
                             The evaporation sequence identifier to figure out which ions
                             from the reconstruction were considered targets.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <field name="model_labels" type="NX_INT" units="NX_UNITLESS">
                        <doc>
                             The raw labels from the DBScan clustering backend process.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <field name="core_sample_indices" type="NX_INT" units="NX_UNITLESS">
                        <doc>
                             The raw array of core sample indices which specify which of the
                             targets are core points.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="n"/>
                        </dimensions>
                    </field>
                    <field name="numerical_label" type="NX_UINT" units="NX_UNITLESS">
                        <doc>
                             Matrix of numerical label for each member in the set.
                             For classical clustering algorithms this can for instance
                             encode the cluster_identifier.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <field name="weight" optional="true" type="NX_NUMBER" units="NX_UNITLESS">
                        <doc>
                             The array of weight which specifies how surely/likely the
                             cluster is associated/assigned to a specific identifier as
                             is specified in the cluster_identifier array.
                             For the DBScan and atom probe tomography the multiplicity
                             of each ion with respect to the cluster. That is how many times
                             should the position of the ion be accounted for because the ion
                             is e.g. a molecular ion with several elements or isotope of
                             requested type.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <field name="is_noise" optional="true" type="NX_BOOLEAN">
                        <doc>
                             Optional bitmask encoding if members of the set are assigned to as noise or not.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <field name="is_core" optional="true" type="NX_BOOLEAN">
                        <doc>
                             Optional bitmask encoding if member of the set are a core point.
                             For details to which feature/cluster an ion/point is a core point
                             consider numerical_label.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="c"/>
                        </dimensions>
                    </field>
                    <group name="statistics" type="NXprocess">
                        <doc>
                             In addition to the detailed storage which members was grouped to
                             which feature/group summary statistics are stored under this group.
                        </doc>
                        <field name="number_of_noise" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Total number of members in the set which are categorized as noise.
                            </doc>
                        </field>
                        <field name="number_of_core" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Total number of members in the set which are categorized as a core point.
                            </doc>
                        </field>
                        <field name="number_of_features" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Total number of clusters (excluding noise and unassigned).
                            </doc>
                        </field>
                        <field name="feature_identifier" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Array of numerical identifier of each feature (cluster).
                            </doc>
                            <dimensions rank="1">
                                <dim index="1" value="n_features"/>
                            </dimensions>
                        </field>
                        <field name="feature_member_count" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Array of number of members for each feature.
                            </doc>
                            <dimensions rank="1">
                                <dim index="1" value="n_features"/>
                            </dimensions>
                        </field>
                    </group>
                </group>
            </group>
        </group>
        <group name="performance" recommended="true" type="NXcs_profiling">
            <field name="current_working_directory" type="NX_CHAR"/>
            <field name="command_line_call" optional="true" type="NX_CHAR"/>
            <field name="start_time" recommended="true" type="NX_DATE_TIME"/>
            <field name="end_time" recommended="true" type="NX_DATE_TIME"/>
            <field name="total_elapsed_time" type="NX_NUMBER"/>
            <field name="number_of_processes" type="NX_POSINT"/>
            <field name="number_of_threads" type="NX_POSINT"/>
            <field name="number_of_gpus" type="NX_POSINT"/>
            <group recommended="true" type="NXcs_computer">
                <field name="name" recommended="true" type="NX_CHAR"/>
                <field name="operating_system" type="NX_CHAR">
                    <attribute name="version" type="NX_CHAR"/>
                </field>
                <field name="uuid" optional="true" type="NX_CHAR"/>
                <group maxOccurs="unbounded" minOccurs="0" type="NXcs_cpu">
                    <field name="name" optional="true" type="NX_CHAR"/>
                    <group recommended="true" type="NXfabrication">
                        <field name="identifier" optional="true" type="NX_CHAR"/>
                        <field name="capabilities" optional="true" type="NX_CHAR"/>
                    </group>
                </group>
                <group maxOccurs="unbounded" minOccurs="0" type="NXcs_gpu">
                    <field name="name" optional="true" type="NX_CHAR"/>
                    <group recommended="true" type="NXfabrication">
                        <field name="identifier" optional="true" type="NX_CHAR"/>
                        <field name="capabilities" optional="true" type="NX_CHAR"/>
                    </group>
                </group>
                <group maxOccurs="1" minOccurs="0" type="NXcs_mm_sys">
                    <field name="total_physical_memory" type="NX_NUMBER"/>
                </group>
                <group maxOccurs="1" minOccurs="0" type="NXcs_io_sys">
                    <group maxOccurs="unbounded" minOccurs="1" type="NXcs_io_obj">
                        <field name="technology" type="NX_CHAR"/>
                        <field name="max_physical_capacity" type="NX_NUMBER"/>
                        <field name="name" optional="true" type="NX_CHAR"/>
                        <group recommended="true" type="NXfabrication">
                            <field name="identifier" optional="true" type="NX_CHAR"/>
                            <field name="capabilities" optional="true" type="NX_CHAR"/>
                        </group>
                    </group>
                </group>
                <group type="NXcs_profiling_event">
                    <field name="start_time" optional="true" type="NX_DATE_TIME"/>
                    <field name="end_time" optional="true" type="NX_DATE_TIME"/>
                    <field name="description" type="NX_CHAR"/>
                    <field name="elapsed_time" type="NX_NUMBER"/>
                    <field name="number_of_processes" type="NX_POSINT">
                        <doc>
                             Specify if it was different from the number_of_processes
                             in the NXcs_profiling super class.
                        </doc>
                    </field>
                    <field name="number_of_threads" type="NX_POSINT">
                        <doc>
                             Specify if it was different from the number_of_threads
                             in the NXcs_profiling super class.
                        </doc>
                    </field>
                    <field name="number_of_gpus" type="NX_POSINT">
                        <doc>
                             Specify if it was different from the number_of_threads
                             in the NXcs_profiling super class.
                        </doc>
                    </field>
                    <field name="max_virtual_memory_snapshot" recommended="true" type="NX_NUMBER"/>
                    <field name="max_resident_memory_snapshot" recommended="true" type="NX_NUMBER"/>
                </group>
            </group>
        </group>
    </group>
</definition>
